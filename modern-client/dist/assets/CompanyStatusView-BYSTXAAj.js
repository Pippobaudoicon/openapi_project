import{f as v,q as C,c as r,a as t,h as u,w as V,v as D,B as j,i as g,m as L,t as a,x as R,F as z,s as P,o as l}from"./index-Cy8y1Ck6.js";import{u as O}from"./company-C-ste4eM.js";const M={class:"space-y-6"},$={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},F={class:"space-y-4"},H={class:"flex gap-4"},K={class:"flex-1"},q=["disabled"],J={key:0,class:"spinner mr-2"},G={class:"border-t pt-4"},Q={class:"space-y-3"},W=["disabled"],X={key:0,class:"spinner mr-2"},Y={key:0,class:"bg-red-50 border border-red-200 rounded-xl p-4"},Z={class:"flex items-center"},tt={class:"text-red-700"},et={key:1,class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},st={class:"flex items-center justify-between mb-4"},ot={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},at={class:"text-lg font-semibold text-gray-900"},nt={class:"text-sm text-gray-900"},rt={key:0},lt={class:"text-sm text-gray-900"},dt={key:1},it={class:"text-sm text-gray-900"},ct={class:"mt-6 pt-6 border-t border-gray-200"},ut={key:0,class:"mt-4 bg-gray-50 rounded-lg p-4 text-xs overflow-auto"},mt={key:2,class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},pt={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},xt={class:"bg-gray-50 rounded-lg p-4 text-center"},vt={class:"text-2xl font-bold text-gray-900"},gt={class:"bg-green-50 rounded-lg p-4 text-center"},yt={class:"text-2xl font-bold text-green-600"},ht={class:"bg-red-50 rounded-lg p-4 text-center"},bt={class:"text-2xl font-bold text-red-600"},ft={class:"bg-yellow-50 rounded-lg p-4 text-center"},wt={class:"text-2xl font-bold text-yellow-600"},_t={class:"overflow-x-auto"},Ct={class:"min-w-full divide-y divide-gray-200"},kt={class:"bg-white divide-y divide-gray-200"},St={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Vt={class:"px-6 py-4 whitespace-nowrap"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},It={__name:"CompanyStatusView",setup(Lt){const c=O(),p=v(""),y=v(""),n=v(null),i=v([]),b=v(!1),w=v(!1),k=async()=>{if(p.value)try{const s=await c.getCompanyClosed(p.value);n.value=s}catch(s){console.error("Error checking company status:",s)}},B=async()=>{const s=y.value.split(`
`).map(o=>o.trim()).filter(o=>o);if(s.length===0)return;w.value=!0;const e=[];for(const o of s){try{const d=await c.getCompanyClosed(o);e.push({piva:o,...d})}catch(d){e.push({piva:o,error:d.message,timestamp:new Date})}await new Promise(d=>setTimeout(d,500))}i.value=e,w.value=!1},m=s=>s?s.error?"Error":s.chiusa===!0||s.stato==="CHIUSA"?"Closed":s.chiusa===!1||s.stato==="ATTIVA"?"Active":"Unknown":"Unknown",S=s=>{switch(m(s)){case"Active":return"bg-green-100 text-green-800";case"Closed":return"bg-red-100 text-red-800";case"Error":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},I=C(()=>i.value.filter(s=>m(s.data)==="Active").length),U=C(()=>i.value.filter(s=>m(s.data)==="Closed").length),N=C(()=>i.value.filter(s=>!["Active","Closed"].includes(m(s.data))).length),_=s=>new Date(s).toLocaleDateString("it-IT",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),T=()=>{const s=["P.IVA","Company Name","Status","Check Date"],e=i.value.map(x=>{var f;return[x.piva,((f=x.data)==null?void 0:f.denominazione)||"N/A",m(x.data),_(x.timestamp)]}),o=[s,...e].map(x=>x.map(f=>`"${f}"`).join(",")).join(`
`),d=new Blob([o],{type:"text/csv"}),A=window.URL.createObjectURL(d),h=document.createElement("a");h.href=A,h.download=`company-status-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(A),document.body.removeChild(h)},E=()=>{i.value=[],n.value=null,y.value=""};return(s,e)=>(l(),r("div",M,[e[17]||(e[17]=t("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[t("h1",{class:"text-2xl font-bold text-gray-900 mb-4"},"Company Status Check"),t("p",{class:"text-gray-600"},"Check if a company is closed or active")],-1)),t("div",$,[t("div",F,[t("div",H,[t("div",K,[V(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),type:"text",placeholder:"Enter P.IVA (e.g., 12345678901)",class:"input-field",onKeyup:j(k,["enter"])},null,544),[[D,p.value]])]),t("button",{onClick:k,disabled:!p.value||g(c).isLoading,class:"btn-primary"},[g(c).isLoading?(l(),r("svg",J)):u("",!0),L(" "+a(g(c).isLoading?"Checking...":"Check Status"),1)],8,q)]),t("div",G,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-3"},"Batch Check",-1)),t("div",Q,[V(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=o=>y.value=o),placeholder:"Enter multiple P.IVAs, one per line",rows:"4",class:"input-field resize-none"},null,512),[[D,y.value]]),t("button",{onClick:B,disabled:!y.value.trim()||g(c).isLoading,class:"btn-secondary"},[w.value?(l(),r("svg",X)):u("",!0),e[3]||(e[3]=L(" Check Multiple "))],8,W)])])])]),g(c).error?(l(),r("div",Y,[t("div",Z,[e[5]||(e[5]=t("svg",{class:"w-5 h-5 text-red-500 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("p",tt,a(g(c).error),1)])])):u("",!0),n.value?(l(),r("div",et,[t("div",st,[e[6]||(e[6]=t("h2",{class:"text-xl font-semibold text-gray-900"},"Company Status",-1)),t("span",{class:R(["px-3 py-1 rounded-full text-sm font-medium",S(n.value.data)])},a(m(n.value.data)),3)]),t("div",ot,[t("div",null,[e[7]||(e[7]=t("dt",{class:"text-sm font-medium text-gray-500 mb-1"},"P.IVA",-1)),t("dd",at,a(p.value),1)]),t("div",null,[e[8]||(e[8]=t("dt",{class:"text-sm font-medium text-gray-500 mb-1"},"Status Check Date",-1)),t("dd",nt,a(_(n.value.timestamp)),1)]),n.value.data.denominazione?(l(),r("div",rt,[e[9]||(e[9]=t("dt",{class:"text-sm font-medium text-gray-500 mb-1"},"Company Name",-1)),t("dd",lt,a(n.value.data.denominazione),1)])):u("",!0),n.value.data.stato?(l(),r("div",dt,[e[10]||(e[10]=t("dt",{class:"text-sm font-medium text-gray-500 mb-1"},"Official Status",-1)),t("dd",it,a(n.value.data.stato),1)])):u("",!0)]),t("div",ct,[t("button",{onClick:e[2]||(e[2]=o=>b.value=!b.value),class:"text-sm text-gray-600 hover:text-gray-900 transition-colors"},a(b.value?"Hide":"Show")+" Raw Data ",1),b.value?(l(),r("pre",ut,a(JSON.stringify(n.value,null,2)),1)):u("",!0)])])):u("",!0),i.value.length>0?(l(),r("div",mt,[t("div",{class:"flex items-center justify-between mb-6"},[e[11]||(e[11]=t("h2",{class:"text-xl font-semibold text-gray-900"},"Batch Results",-1)),t("div",{class:"flex gap-2"},[t("button",{onClick:T,class:"btn-secondary"}," Export CSV "),t("button",{onClick:E,class:"btn-secondary"}," Clear Results ")])]),t("div",pt,[t("div",xt,[t("div",vt,a(i.value.length),1),e[12]||(e[12]=t("div",{class:"text-sm text-gray-600"},"Total Checked",-1))]),t("div",gt,[t("div",yt,a(I.value),1),e[13]||(e[13]=t("div",{class:"text-sm text-gray-600"},"Active",-1))]),t("div",ht,[t("div",bt,a(U.value),1),e[14]||(e[14]=t("div",{class:"text-sm text-gray-600"},"Closed",-1))]),t("div",ft,[t("div",wt,a(N.value),1),e[15]||(e[15]=t("div",{class:"text-sm text-gray-600"},"Unknown",-1))])]),t("div",_t,[t("table",Ct,[e[16]||(e[16]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"P.IVA"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Company Name"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Check Date")])],-1)),t("tbody",kt,[(l(!0),r(z,null,P(i.value,o=>{var d;return l(),r("tr",{key:o.piva},[t("td",St,a(o.piva),1),t("td",At,a(((d=o.data)==null?void 0:d.denominazione)||"N/A"),1),t("td",Vt,[t("span",{class:R(["px-2 py-1 text-xs rounded-full",S(o.data)])},a(m(o.data)),3)]),t("td",Dt,a(_(o.timestamp)),1)])}),128))])])])])):u("",!0)]))}};export{It as default};
