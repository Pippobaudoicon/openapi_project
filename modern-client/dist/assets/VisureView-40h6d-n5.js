import{f as p,g as q,c as a,a as e,h as n,F as x,s as k,w as m,v,B as z,i as c,m as g,t as r,o as i,x as A}from"./index-Cy8y1Ck6.js";import{u as P}from"./company-C-ste4eM.js";const N={class:"space-y-6"},T={class:"bg-white rounded-xl shadow-sm border border-gray-200"},$={class:"border-b border-gray-200"},F={class:"-mb-px flex space-x-8 px-6"},K=["onClick"],G={class:"p-6"},J={key:0,class:"space-y-6"},H={class:"flex gap-4"},Q=["disabled"],W={key:0,class:"spinner mr-2"},X={key:0,class:"bg-gray-50 rounded-lg p-4"},Y={class:"text-sm overflow-auto"},Z={key:1,class:"space-y-6"},ee={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},te=["disabled"],se={key:0,class:"spinner mr-2"},oe={key:0,class:"space-y-4"},ae={class:"text-lg font-semibold"},ie={class:"grid gap-4"},le={class:"flex justify-between items-start"},ne={class:"font-semibold text-gray-900"},re={class:"text-sm text-gray-600"},de={class:"text-sm text-gray-600"},ce=["onClick"],ue={key:2,class:"space-y-6"},pe={class:"space-y-4"},me={class:"flex gap-4"},ve=["disabled"],ye={key:0,class:"spinner mr-2"},be=["disabled"],_e={key:0,class:"bg-gray-50 rounded-lg p-4"},ge={class:"space-y-2"},he={key:0},fe={class:"border-t pt-6"},xe={class:"flex justify-between items-center mb-4"},ke=["disabled"],we={key:0,class:"space-y-2"},Ce={class:"font-medium"},Ve={class:"text-sm text-gray-600"},Be=["onClick"],De={key:3,class:"space-y-6"},Re={class:"flex justify-between items-center"},Se=["disabled"],Ae={key:0,class:"space-y-4"},Ie={class:"flex justify-between items-start"},Le={class:"font-semibold"},Ee={class:"text-sm text-gray-600"},Ue={class:"text-sm text-gray-600"},je={key:0,class:"bg-red-50 border border-red-200 rounded-xl p-4"},Oe={class:"flex items-center"},Me={class:"text-red-700"},Ne={__name:"VisureView",setup(qe){const l=P(),b=p("impresa"),I=[{id:"impresa",label:"Impresa Data"},{id:"search",label:"Search Companies"},{id:"bilancio",label:"Bilancio Ottico"},{id:"all",label:"All Visure"}],h=p(""),w=p(null),d=p({denominazione:"",provincia:"",codice_ateco:"",fatturato_min:"",fatturato_max:"",dipendenti_min:"",dipendenti_max:""}),f=p(null),_=p(""),y=p(null),C=p(null),V=p(null),B=async()=>{try{const s=await l.getImpresaData(h.value);w.value=s.data}catch(s){console.error("Error fetching impresa data:",s)}},L=async()=>{try{const s=Object.fromEntries(Object.entries(d.value).filter(([o,u])=>u!=="")),t=await l.searchImpresa(s);f.value=t.data}catch(s){console.error("Error searching impresa:",s)}},E=async()=>{try{const s=await l.requestBilancioOttico(_.value);y.value=s.data}catch(s){console.error("Error requesting bilancio:",s)}},U=async()=>{try{const s=await l.getBilancioOtticoStatus(_.value);y.value=s.data}catch(s){console.error("Error checking bilancio status:",s)}},D=async s=>{try{const t=await l.downloadBilancioOtticoFiles(s),o=window.URL.createObjectURL(t),u=document.createElement("a");u.href=o,u.download=`bilancio-${s}.zip`,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(o),document.body.removeChild(u)}catch(t){console.error("Error downloading files:",t)}},R=async()=>{try{const s=await l.getAllBilancioOtticoRequests();C.value=s.data}catch(s){console.error("Error loading bilancio requests:",s)}},S=async()=>{try{const s=await l.getAllVisure();V.value=s.data}catch(s){console.error("Error loading visure:",s)}},j=s=>{console.log("Selected company:",s)},O=s=>{if(!s)return"N/A";if(typeof s=="string")return s;const t=[];return s.via&&t.push(s.via),s.civico&&t.push(s.civico),s.cap&&t.push(s.cap),s.comune&&t.push(s.comune),s.provincia&&t.push(`(${s.provincia})`),t.join(" ")},M=s=>new Date(s).toLocaleDateString("it-IT");return q(()=>{S(),R()}),(s,t)=>(i(),a("div",N,[t[18]||(t[18]=e("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[e("h1",{class:"text-2xl font-bold text-gray-900 mb-4"},"Visure Management"),e("p",{class:"text-gray-600"},"Manage company visure, impresa data, and bilancio ottico requests")],-1)),e("div",T,[e("div",$,[e("nav",F,[(i(),a(x,null,k(I,o=>e("button",{key:o.id,onClick:u=>b.value=o.id,class:A(["py-4 px-1 border-b-2 font-medium text-sm transition-colors",b.value===o.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},r(o.label),11,K)),64))])]),e("div",G,[b.value==="impresa"?(i(),a("div",J,[e("div",H,[m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>h.value=o),type:"text",placeholder:"Enter P.IVA for impresa data",class:"input-field flex-1",onKeyup:z(B,["enter"])},null,544),[[v,h.value]]),e("button",{onClick:B,disabled:!h.value||c(l).isLoading,class:"btn-primary"},[c(l).isLoading?(i(),a("svg",W)):n("",!0),t[9]||(t[9]=g(" Get Impresa Data "))],8,Q)]),w.value?(i(),a("div",X,[e("pre",Y,r(JSON.stringify(w.value,null,2)),1)])):n("",!0)])):n("",!0),b.value==="search"?(i(),a("div",Z,[e("div",ee,[m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>d.value.denominazione=o),type:"text",placeholder:"Company Name",class:"input-field"},null,512),[[v,d.value.denominazione]]),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>d.value.provincia=o),type:"text",placeholder:"Province",class:"input-field"},null,512),[[v,d.value.provincia]]),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>d.value.codice_ateco=o),type:"text",placeholder:"ATECO Code",class:"input-field"},null,512),[[v,d.value.codice_ateco]]),m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>d.value.fatturato_min=o),type:"number",placeholder:"Min Revenue",class:"input-field"},null,512),[[v,d.value.fatturato_min]]),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>d.value.fatturato_max=o),type:"number",placeholder:"Max Revenue",class:"input-field"},null,512),[[v,d.value.fatturato_max]]),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>d.value.dipendenti_min=o),type:"number",placeholder:"Min Employees",class:"input-field"},null,512),[[v,d.value.dipendenti_min]])]),e("button",{onClick:L,disabled:c(l).isLoading,class:"btn-primary"},[c(l).isLoading?(i(),a("svg",se)):n("",!0),t[10]||(t[10]=g(" Search Companies "))],8,te),f.value?(i(),a("div",oe,[e("h3",ae,"Search Results ("+r(f.value.length)+")",1),e("div",ie,[(i(!0),a(x,null,k(f.value.slice(0,10),o=>(i(),a("div",{key:o.piva,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"},[e("div",le,[e("div",null,[e("h4",ne,r(o.denominazione),1),e("p",re,"P.IVA: "+r(o.piva),1),e("p",de,r(O(o.sede_legale)),1)]),e("button",{onClick:u=>j(o),class:"text-primary-600 hover:text-primary-800 text-sm font-medium"}," View Details ",8,ce)])]))),128))])])):n("",!0)])):n("",!0),b.value==="bilancio"?(i(),a("div",ue,[e("div",pe,[e("div",me,[m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>_.value=o),type:"text",placeholder:"Enter P.IVA for bilancio ottico",class:"input-field flex-1"},null,512),[[v,_.value]]),e("button",{onClick:E,disabled:!_.value||c(l).isLoading,class:"btn-primary"},[c(l).isLoading?(i(),a("svg",ye)):n("",!0),t[11]||(t[11]=g(" Request Bilancio "))],8,ve),e("button",{onClick:U,disabled:!_.value||c(l).isLoading,class:"btn-secondary"}," Check Status ",8,be)]),y.value?(i(),a("div",_e,[t[14]||(t[14]=e("h4",{class:"font-semibold mb-2"},"Bilancio Status",-1)),e("div",ge,[e("p",null,[t[12]||(t[12]=e("span",{class:"font-medium"},"Status:",-1)),g(" "+r(y.value.stato_richiesta),1)]),e("p",null,[t[13]||(t[13]=e("span",{class:"font-medium"},"Request ID:",-1)),g(" "+r(y.value.id),1)]),y.value.stato_richiesta==="Dati disponibili"?(i(),a("div",he,[e("button",{onClick:t[8]||(t[8]=o=>D(y.value.id)),class:"btn-primary mt-2"}," Download Files ")])):n("",!0)])])):n("",!0)]),e("div",fe,[e("div",xe,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold"},"All Bilancio Requests",-1)),e("button",{onClick:R,disabled:c(l).isLoading,class:"btn-secondary"}," Refresh ",8,ke)]),C.value?(i(),a("div",we,[(i(!0),a(x,null,k(C.value,o=>(i(),a("div",{key:o.id,class:"border border-gray-200 rounded-lg p-3 flex justify-between items-center"},[e("div",null,[e("p",Ce,"ID: "+r(o.id),1),e("p",Ve,"Status: "+r(o.stato_richiesta),1)]),o.stato_richiesta==="Dati disponibili"?(i(),a("button",{key:0,onClick:u=>D(o.id),class:"text-primary-600 hover:text-primary-800 text-sm"}," Download ",8,Be)):n("",!0)]))),128))])):n("",!0)])])):n("",!0),b.value==="all"?(i(),a("div",De,[e("div",Re,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold"},"All Cached Visure",-1)),e("button",{onClick:S,disabled:c(l).isLoading,class:"btn-secondary"}," Refresh ",8,Se)]),V.value?(i(),a("div",Ae,[(i(!0),a(x,null,k(V.value,o=>(i(),a("div",{key:o._id,class:"border border-gray-200 rounded-lg p-4"},[e("div",Ie,[e("div",null,[e("p",Le,r(o.searchType.toUpperCase()),1),e("p",Ee,"P.IVA: "+r(o.piva),1),e("p",Ue,"Created: "+r(M(o.createdAt)),1)]),e("span",{class:A(["px-2 py-1 text-xs rounded-full",o.status==="complete"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},r(o.status||"completed"),3)])]))),128))])):n("",!0)])):n("",!0)])]),c(l).error?(i(),a("div",je,[e("div",Oe,[t[17]||(t[17]=e("svg",{class:"w-5 h-5 text-red-500 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Me,r(c(l).error),1)])])):n("",!0)]))}};export{Ne as default};
